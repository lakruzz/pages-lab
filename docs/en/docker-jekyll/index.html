<!DOCTYPE html>
<html>

    <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Oswald:300,400,700|Noto+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="/css/lakruzz.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/css/lakruzz-styles.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/css/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/css/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="/css/syntax.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/css/slider.css" media="screen">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" title="Subscribe to the RSS feed" href="/feed.xml" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="/javascripts/googleanalytics.js"></script>

      <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Docker Jekyll - 5 easy steps | Lakruzz - Personal blog by Lars Kruse</title>
<meta property="og:title" content="Docker Jekyll - 5 easy steps" />
<meta name="author" content="lakruzz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jekyll is a static web page generator made in Ruby. It’s the engine that runs GitHub Pages. In the following you will get five easy steps to run jekyll locally, without even installing it, but simply through running a docker image." />
<meta property="og:description" content="Jekyll is a static web page generator made in Ruby. It’s the engine that runs GitHub Pages. In the following you will get five easy steps to run jekyll locally, without even installing it, but simply through running a docker image." />
<link rel="canonical" href="http://www.lakruzz.com/pages-lab/en/docker-jekyll/" />
<meta property="og:url" content="http://www.lakruzz.com/pages-lab/en/docker-jekyll/" />
<meta property="og:site_name" content="Lakruzz - Personal blog by Lars Kruse" />
<meta property="og:image" content="http://www.lakruzz.com/pages-lab/images/blog/docker-jekyll.some.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-03T00:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@lakruzz" />
<meta name="twitter:creator" content="@lakruzz" />
<script type="application/ld+json">
{"@type":"BlogPosting","publisher":null,"url":"http://www.lakruzz.com/pages-lab/en/docker-jekyll/","dateModified":"2018-03-03T00:00:00+01:00","datePublished":"2018-03-03T00:00:00+01:00","sameAs":null,"headline":"Docker Jekyll - 5 easy steps","name":null,"author":{"@type":"Person","name":"lakruzz"},"image":"http://www.lakruzz.com/pages-lab/images/blog/docker-jekyll.some.png","description":"Jekyll is a static web page generator made in Ruby. It’s the engine that runs GitHub Pages. In the following you will get five easy steps to run jekyll locally, without even installing it, but simply through running a docker image.","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.lakruzz.com/pages-lab/en/docker-jekyll/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="twitter:image" content="http://www.lakruzz.com/images/blog/docker-jekyll.some.png"/>

  </head>


  <body>

        <header>
      <div class="inner">
        <h1>Lakruzz</h1>
        <h2>Blogs by Lars Kruse</h2>
        <!--a href="https://github.com/lakruzz/lakruzz.github.io" class="button" target="_blank"><small>This page is hosted at GitHub pages from the <span style="color:#fe950d;">Lakruzz</span> repo</small></a-->
        <a class="menu" href="/">Lakruzz</a>
        <a class="menu" href="/posts">Blog</a>
        <a class="menu" href="/en/wolfware-republished">WolfWare</a>
      </div>
    </header>


    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

          <strong>Category</strong>
            
              
                
              
            
              
                
              
            
              
                
              
            
              
                
                  <em><span title="Articles, blogs, ideas etc written in English">Blogs in English</span></em>&nbsp;&nbsp;
                 
              
            <br/>
          <strong>By:&nbsp;</strong>
            <em>lakruzz</em>&nbsp;&nbsp;
          <br/>
          <strong> On:</strong>
          Saturday, March 03. 2018<br/>
          <strong>Tags:&nbsp;|</strong>
          
            <a href="/tags/#Docker">Docker</a>&nbsp;|&nbsp;
          
            <a href="/tags/#Docker machine">Docker machine</a>&nbsp;|&nbsp;
          
            <a href="/tags/#Jekyll">Jekyll</a>&nbsp;|&nbsp;
          
            <a href="/tags/#MacOS">MacOS</a>&nbsp;|&nbsp;
          
        <br/>

          <h1>Docker Jekyll - 5 easy steps</h1>

          <p class="kicker">Jekyll is a static web page generator made in Ruby. It’s the engine that runs GitHub Pages. In the following you will get five easy steps to run jekyll locally, without even installing it, but simply through running a docker image.</p>

<p>The following instructions assumes that you are on a Mac, but it’s even easier if you are on Linux. On linux you can simply skip steps 2+3, since you don’t need a virtual host machine for your Docker.</p>

<p><img src="/images/blog/docker-jekyll.png" alt="Docker Jekyll" class="pic right small" /></p>
<h2 id="1-get-docker-on-your-machine">1. Get Docker on your machine</h2>
<p>If you already have Docker installed and knows that it’s working for you - you are already onto the next step.</p>

<p>The easiest way to install Docker on Mac is to use the <a href="https://docs.brew.sh/" target="_blank">Homebrew package manager</a>. If you don’t have it setup already you must do it straight away, it’s an absolute must.</p>

<p>Run this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby <span class="nt">-e</span> <span class="s2">"</span><span class="k">$(</span>curl <span class="nt">-fsSL</span> <span class="se">\</span>
  https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">"</span>
</code></pre></div></div>

<p>Once Homebrew is installed on your Mac, Docker installation is as easy as:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew cask install virtualbox
brew install docker
brew install docker-machine
</code></pre></div></div>

<h2 id="2-create-a-default-docker-machine">2. Create a “default” Docker Machine</h2>

<p>Since your Mac isn’t running Linux natively and your Docker container depends on it, you must have a <em>docker-machine</em> available. This is simply how Docker works on non-linux OS, including MacOS and Windows. I’ll use the name “default” in my example, but if you want to call it something else, go ahead, just replace my instances of “default” with you own name in the following instructions.</p>

<p>I you already have a “default” docker machine running then you can move directly onto the next step. If not this is what you need to do:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-machine create <span class="nt">--driver</span> virtualbox default
</code></pre></div></div>
<p>OK that was easy - “default” docker-machine created! Now you need to start it.</p>

<p>If you just created it, then it will be running. To be sure you can run <code class="highlighter-rouge">docker-machine ls</code>. If your “default” machine isn’t running, you need to start it again.</p>

<p>Like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-machine start default
</code></pre></div></div>
<p>But it’s even more convenient to configure your Mac to start it up automatically at each reboot.</p>

<p><a href="https://docs.docker.com/machine/get-started/#start-local-machines-on-startup">The way to do that</a> is to configure a launcher. Create a file called <code class="highlighter-rouge">com.docker.machine.default.plist</code> in the <code class="highlighter-rouge">~/Library/LaunchAgents/</code> directory, with the following content:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
  "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dict&gt;</span>
        <span class="nt">&lt;key&gt;</span>EnvironmentVariables<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>PATH<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;string&gt;</span>/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;/dict&gt;</span>
        <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>com.docker.machine.default<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;array&gt;</span>
            <span class="nt">&lt;string&gt;</span>/usr/local/bin/docker-machine<span class="nt">&lt;/string&gt;</span>
            <span class="nt">&lt;string&gt;</span>start<span class="nt">&lt;/string&gt;</span>
            <span class="nt">&lt;string&gt;</span>default<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;/array&gt;</span>
        <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</code></pre></div></div>

<p>Next time you reboot your Mac, the Docker-machine will start automatically.</p>

<h2 id="3-prepare-your-shell-to-use-the-default-docker-machine">3. Prepare your shell to use the “default” docker-machine</h2>

<p>Before you can use the <code class="highlighter-rouge">docker run</code> command you will need to configure your environment. You just simply have to run:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>docker-machine env default<span class="k">)</span><span class="s2">"</span>
</code></pre></div></div>

<p>Unfortunately you need to do this every time you open a new terminal. If you find that slightly annoying, then it’s highly recommended that you just add the command to your environment file (<code class="highlighter-rouge">~/.zshrc</code>, <code class="highlighter-rouge">~/.bashrc</code> or what ever you are using.)</p>

<h2 id="4-define-a-jekyll-alias">4. Define a “jekyll” alias</h2>

<p>We want jekyll to be available as a native command, without actually installing it, so now when I have Docker working for me, I can use a docker container (<strong>lakruzz/jekyll-plus</strong><sup id="fnref:jekyll-plus"><a href="#fn:jekyll-plus" class="footnote">1</a></sup>) that I’ve made available from the public Docker registry. So all we need is an alias, it looks like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">jekyll</span><span class="o">=</span><span class="s2">"docker run -i -t --rm </span><span class="se">\</span><span class="s2">
  -v </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/app:rw --workdir /app </span><span class="se">\</span><span class="s2">
  -p 80:4000 --entrypoint jekyll lakruzz/jekyll-plus"</span>
</code></pre></div></div>

<p>Like in the previous step, this alias is not one you want to define every time you open a new terminal, so to make the alias permanent, simply open your environment resource file (<code class="highlighter-rouge">~/.zshrc</code>, <code class="highlighter-rouge">~/.bashrc</code> …) again and add it there.</p>

<p>And while you have your resource file open I have another useful alias that I use frequently:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">stage</span><span class="o">=</span><span class="s2">"open http://</span><span class="sb">`</span>docker-machine ip default<span class="sb">`</span><span class="s2">"</span>
</code></pre></div></div>

<p>It defines an alias <code class="highlighter-rouge">stage</code>. When you run it, it will open a web browser, pointing to the jekyll site hosted from your “default” Docker machine.</p>

<h2 id="5-create-a-local-config-file-in-you-jekyll-website">5. Create a local config file in you jekyll website</h2>

<p>To serve a Jekyll site you could simply run:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jekyll serve
</code></pre></div></div>

<p>However, when you run <code class="highlighter-rouge">jekyll serve</code> from a docker container, there are a few additional settings that needs to be applied as switches. Typically you would need to define <code class="highlighter-rouge">--host 0.0.0.0</code> and since you are mounting the local disk into the docker container, you will typically also have to force the watch to poll with <code class="highlighter-rouge">--force_polling</code>.</p>

<p>But there is more: Often when I run Jekyll in development mode I also want to build all unpublished pages, build incremental, run in verbose mode etc.</p>

<p>So the command I should use look like this</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jekyll serve <span class="nt">--host</span> 0.0.0.0 <span class="nt">--force_polling</span> <span class="se">\</span>
   <span class="nt">--incremental</span> <span class="nt">--drafts</span> <span class="nt">--future</span> <span class="nt">--unpublished</span> <span class="nt">--verbose</span>
</code></pre></div></div>
<p>It starts to get kinda lengthy.</p>

<p>So instead of stacking all these switches on top of the <code class="highlighter-rouge">jekyll serve</code> command, I’ve created an extra jekyll configuration file, alongside the default <code class="highlighter-rouge">_config.yml</code>. I’ve called it <code class="highlighter-rouge">_dev_config.yml</code> and it contains the following:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Required when running from a Docker container</span>
<span class="na">host</span><span class="pi">:</span> <span class="s">0.0.0.0</span>
<span class="na">force_polling</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># Speed it up a bit</span>
<span class="na">incremental</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># How much to render? These all default to false - But I want them all when I develop.</span>
<span class="na">show_drafts</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">future</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">unpublished</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># Make the machine talk to you</span>
<span class="na">verbose</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Now, with everything set up, I can change directory into the folder that contains my jekyll site and build and serve is like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jekyll serve <span class="nt">--config</span> _config.yml,_dev_config.yml
</code></pre></div></div>

<p>I’ve even created an alias for that as well. The things I end up adding to my <code class="highlighter-rouge">.zshrc</code> (… or <code class="highlighter-rouge">.bashrc</code>) file sums up to:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Docker-machine env setup</span>
<span class="nb">eval</span> <span class="k">$(</span>docker-machine env default<span class="k">)</span>

<span class="c"># Docker Jekyll aliases</span>
<span class="nb">alias </span><span class="nv">stage</span><span class="o">=</span><span class="s2">"open http://</span><span class="sb">`</span>docker-machine ip default<span class="sb">`</span><span class="s2">"</span>
<span class="nb">alias </span><span class="nv">jekyll</span><span class="o">=</span><span class="s2">"docker run -i -t --rm -v </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/app:rw --workdir /app </span><span class="se">\</span><span class="s2">
  -p 80:4000 --entrypoint jekyll lakruzz/jekyll-plus"</span>
<span class="nb">alias </span>dev-jekyll<span class="o">=</span><span class="s1">'docker run -i -t --rm -v $(pwd):/app:rw --workdir /app \
  -p 80:4000 --entrypoint jekyll lakruzz/jekyll-plus \
  serve --config _config.yml,_dev_config.yml'</span>
</code></pre></div></div>

<h2 id="docker-jekyll---anything-as-code">Docker Jekyll - anything as code</h2>

<p>The approached described here, for running Jekyll locally, without actually installing it taps perfectly into the contemporary <em>anything as code</em> buzz; If you build your web site for production using the same image as you use for development it’s game over for all the <em>snowflake</em> servers - I’ll touch on this topic in a future blog.</p>
<div class="footnotes">
  <ol>
    <li id="fn:jekyll-plus">
      <p>The <a href="https://hub.docker.com/r/lakruzz/jekyll-plus/" target="_blank">lakruzz/jekyll-plus</a> Docker image is an image that installs the stack used for GitHub Pages, It relies on the Ruby gem that is maintained by GitHub. In addition I’ve added a few jekyll plugins that are really neat but unsupported by GitHub pages. Most prominent is the <a href="https://github.com/wildlyinaccurate/jekyll-responsive-image" target="_blank">jekyll-responsive-image</a> plugin, but if you use it, you will have to become self-hosted. I’ll get back to that in another blog later. <a href="#fnref:jekyll-plus" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>



        </section>
          <aside id="sidebar">
            
    
      
    
      
    
      
    
      
        <div style="padding-bottom:15px;"><a name="en"></a>
          <b><span title="Articles, blogs, ideas etc written in English">Blogs in English<span></b>
          
            
                <div class="list"><a title="" href=""></a></div>
            
          
            
                <div class="list"><a title="Saturday March 3. 2018" href="/en/docker-jekyll/">Docker Jekyll - 5 easy steps</a></div>
            
                <div class="list"><a title="Saturday February 3. 2018" href="/en/dorith/">The DORITH principle</a></div>
            
                <div class="list"><a title="Tuesday December 29. 2015" href="/en/wolfware-republished/">WolfWare - 2016 Republish Preface</a></div>
            
                <div class="list"><a title="Saturday December 27. 2014" href="/en/kovalam+tourist+anywhere/">Kovalam - Tourist Anywhere</a></div>
            
                <div class="list"><a title="Friday December 19. 2014" href="/en/dewalokam+day+5/">Goodbye Dewalokam</a></div>
            
                <div class="list"><a title="Thursday December 18. 2014" href="/en/dewalokam+day+4/">Tea plantations - goddamit</a></div>
            
                <div class="list"><a title="Wednesday December 17. 2014" href="/en/dewalokam+day+3/">Tuk tuks and public roller coaster</a></div>
            
                <div class="list"><a title="Tuesday December 16. 2014" href="/en/dewalokam+day+2/">Interesting Danish accent</a></div>
            
                <div class="list"><a title="Monday December 15. 2014" href="/en/cochin-dewalokam/">Very very welcome to Dewalokam</a></div>
            
          
        </div>
      
    

    
      
    
      
    
      
        <div style="padding-bottom:15px;"><a name="da"></a>
          <b><span title="Artikler, blogs, ideer osv skrevet på dansk.">Blogs på dansk<span></b>
          
            
                <div class="list"><a title="" href=""></a></div>
            
          
            
                <div class="list"><a title="Saturday May 7. 2016" href="/da/code+devops+paradigmeskift/">Et Paradigmeskift inden for softwareudvikling</a></div>
            
                <div class="list"><a title="Wednesday December 24. 2014" href="/da/christmas+in+cochin/">Jul i Cochin</a></div>
            
          
        </div>
      
    
      
    




    
          </aside>

        <script src="https://apis.google.com/js/plusone.js"></script>
<script>
  document.write(
    '<div class="g-comments"'+
    '  data-href="' + document.URL + '"'+
    '  data-width="642"'+
    '  data-first_party_property="BLOGGER"'+
    '  data-view_type="FILTERED_POSTMOD">'+
    '</div>'
  )
</script>


      </div>
    </div>
  </body>
</html>
